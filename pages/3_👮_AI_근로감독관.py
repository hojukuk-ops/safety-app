import streamlit as st
import google.generativeai as genai

# [ì£¼ì˜] st.set_page_configëŠ” app.pyì—ì„œ ì„¤ì •í•˜ë¯€ë¡œ ìƒëµ

# API í‚¤ ì„¤ì •
try:
    API_KEY = st.secrets["GOOGLE_API_KEY"]
    genai.configure(api_key=API_KEY)
except:
    st.error("ğŸš¨ API í‚¤ ì˜¤ë¥˜: secrets.tomlì„ í™•ì¸í•˜ì„¸ìš”.")
    st.stop()

# ==========================================
# í—¤ë”: AI ê·¼ë¡œê°ë…ê´€ í˜ë¥´ì†Œë‚˜ ì„¤ì •
# ==========================================
st.title("ğŸ‘® AI ê·¼ë¡œê°ë…ê´€ (ë²•ë ¹ ìƒë‹´)")
st.info("ì‚°ì—…ì•ˆì „ë³´ê±´ë²•, ì¤‘ëŒ€ì¬í•´ì²˜ë²Œë²• ë“± ë³µì¡í•œ ë²•ë ¹, **AI ê·¼ë¡œê°ë…ê´€**ì—ê²Œ ë°”ë¡œ ë¬¼ì–´ë³´ì„¸ìš”!")

# íƒ­ ë©”ë‰´ êµ¬ì„±
tab1, tab2, tab3 = st.tabs(["ğŸ’¬ ë²•ë ¹ ìƒë‹´(ì±„íŒ…)", "âš–ï¸ ë²•ë ¹ 3ë‹¨ ë³´ê¸°", "ğŸ“‘ ì‚¬ë‚´ ê·œì •"])

# ==========================================
# [íƒ­ 1] AI ê·¼ë¡œê°ë…ê´€ ì±„íŒ… (ë©”ì¸ ê¸°ëŠ¥)
# ==========================================
with tab1:
    # ì±„íŒ…ë°© ëŠë‚Œì„ ì£¼ëŠ” ë””ìì¸
    with st.chat_message("assistant"):
        st.write("ë°˜ê°‘ìŠµë‹ˆë‹¤. ì•ˆì‚°ë„ì‹œê³µì‚¬ **AI ê·¼ë¡œê°ë…ê´€**ì…ë‹ˆë‹¤. ğŸ‘®â€â™‚ï¸\n\nì‘ì—… í˜„ì¥ì˜ ì•ˆì „ ê¸°ì¤€ì´ë‚˜ ë²•ì  ê³¼íƒœë£Œ ì‚¬í•­ ë“± ê¶ê¸ˆí•œ ì ì„ ë¬¼ì–´ë³´ì„¸ìš”.")

    # ì‚¬ìš©ì ì…ë ¥
    user_question = st.chat_input("ì§ˆë¬¸ ì˜ˆ: 2m ì´ìƒ ê³ ì†Œì‘ì—… ì‹œ ì•ˆì „ë‚œê°„ ì„¤ì¹˜ ê¸°ì¤€ì€?")

    if user_question:
        # ì‚¬ìš©ìì˜ ì§ˆë¬¸ì„ í™”ë©´ì— í‘œì‹œ
        with st.chat_message("user"):
            st.write(user_question)

        # AI ë‹µë³€ ìƒì„± ë° í‘œì‹œ
        with st.chat_message("assistant"):
            with st.spinner("ë²•ë ¹ ë° ì§€ì¹¨ì„ ê²€í†  ì¤‘ì…ë‹ˆë‹¤..."):
                try:
                    model = genai.GenerativeModel('gemini-3-flash-preview')
                    prompt = f"""
                    ë‹¹ì‹ ì€ ëƒ‰ì² í•˜ê³  ì •í™•í•œ 'ëŒ€í•œë¯¼êµ­ ê³ ìš©ë…¸ë™ë¶€ ê·¼ë¡œê°ë…ê´€'ì´ì 'ì‚°ì—…ì•ˆì „ ì „ë¬¸ê°€'ì…ë‹ˆë‹¤.
                    ì‚¬ìš©ìì˜ ì§ˆë¬¸ì— ëŒ€í•´ ë²•ì  ê·¼ê±°(ì‚°ì—…ì•ˆì „ë³´ê±´ë²•, ì‹œí–‰ë ¹, ê·œì¹™, KOSHA Guide ë“±)ë¥¼ ëª…í™•íˆ ë“¤ì–´ ë‹µë³€í•˜ì„¸ìš”.
                    
                    [ë‹µë³€ ì›ì¹™]
                    1. ê·¼ê±° ì—†ëŠ” ë‹µë³€ì€ í•˜ì§€ ì•ŠëŠ”ë‹¤.
                    2. ë²• ì¡°í•­(ì œëª‡ì¡° ì œëª‡í•­)ì„ êµ¬ì²´ì ìœ¼ë¡œ ëª…ì‹œí•œë‹¤.
                    3. í˜„ì¥ì—ì„œ ì‹¤ì²œí•´ì•¼ í•  'í•µì‹¬ ì¡°ì¹˜ì‚¬í•­'ì„ ìš”ì•½í•´ì¤€ë‹¤.
                    4. ë§íˆ¬ëŠ” ì •ì¤‘í•˜ë˜, ì „ë¬¸ê°€ë‹µê²Œ ë‹¨í˜¸í•˜ê³  ëª…í™•í•˜ê²Œ í•œë‹¤.

                    ì‚¬ìš©ì ì§ˆë¬¸: {user_question}
                    """
                    response = model.generate_content(prompt)
                    st.markdown(response.text)
                except Exception as e:
                    st.error(f"ìƒë‹´ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {e}")

# ==========================================
# [íƒ­ 2] ë²•ë ¹ 3ë‹¨ ë³´ê¸° (í•µì‹¬ ë²•ë ¹ë§Œ ê¹”ë”í•˜ê²Œ!)
# ==========================================
with tab2:
    st.markdown("### âš–ï¸ ì£¼ìš” ì•ˆì „ ë²•ë ¹ (3ë‹¨ ë³´ê¸°)")
    st.caption("ğŸ‘‡ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë²•(ë²•ë¥ ), ì‹œí–‰ë ¹, ì‹œí–‰ê·œì¹™ì„ í•œ í™”ë©´ì—ì„œ ì—°ê²°í•´ ë´…ë‹ˆë‹¤.")
    st.write("") # ì—¬ë°±

    col1, col2, col3 = st.columns(3)
    
    with col1:
        st.link_button("ğŸ—ï¸ ì‚°ì•ˆë²• (3ë‹¨)", "https://www.law.go.kr/LSW/lsSc.do?menuId=1&query=%EC%82%B0%EC%97%85%EC%95%88%EC%A0%84%EB%B3%B4%EA%B1%B4%EB%B2%95", use_container_width=True)
    with col2:
        st.link_button("âš–ï¸ ì¤‘ì²˜ë²• (3ë‹¨)", "https://www.law.go.kr/LSW/lsSc.do?menuId=1&query=%EC%A4%91%EB%8C%80%EC%9E%AC%ED%95%B4%EC%B2%98%EB%B2%8C%EB%B2%95", use_container_width=True)
    with col3:
        st.link_button("ğŸš¨ ì¬ë‚œë²• (3ë‹¨)", "https://www.law.go.kr/LSW/lsSc.do?menuId=1&query=%EC%9E%AC%EB%82%9C%20%EB%B0%8F%20%EC%95%88%EC%A0%84%EA%B4%80%EB%A6%AC%20%EA%B8%B0%EB%B3%B8%EB%B2%95", use_container_width=True)

# ==========================================
# [íƒ­ 3] ì‚¬ë‚´ ê·œì • (ì•ˆì‚°ë„ì‹œê³µì‚¬ ì „ì²´ ê·œì •)
# ==========================================
with tab3:
    st.markdown("### ğŸ“‘ ì•ˆì‚°ë„ì‹œê³µì‚¬ ì‚¬ê·œ")
    st.info("êµ­ê°€ë²•ë ¹ì •ë³´ì„¼í„°ì™€ ì—°ë™ëœ ê³µì‚¬ ìµœì‹  ê·œì •ì…ë‹ˆë‹¤.")
    st.write("")

    # ë²„íŠ¼ í•˜ë‚˜ë§Œ ë‚¨ê¸°ê³ , ê½‰ ì°¨ê²Œ ë°°ì¹˜
    st.link_button(
        "ğŸ¢ ì•ˆì‚°ë„ì‹œê³µì‚¬ ê·œì • ì „ì²´ë³´ê¸°", 
        "https://www.law.go.kr/schlPubRulSc.do?menuId=13&subMenuId=467&tabMenuId=509&query=%EC%95%88%EC%82%B0%EB%8F%84%EC%8B%9C%EA%B3%B5%EC%82%AC", 
        use_container_width=True
    )